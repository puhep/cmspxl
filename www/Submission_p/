<?php

function waferinfo($id, $vendor, $thickness, $year, $notes){
include('../connect.php');

	$fthickness = floatval($thickness);
	$iyear = intval($year);

	$date = date('Y-m-d H:i:s');

	if($notes != ""){
		$notes = $date."  ".$notes;
	}

	$func = "INSERT INTO wafer_p(notes, name, vendor, thickness, year, assembly) VALUES (\"$notes\", \"$id\", \"$vendor\", \"$fthickness\", \"$iyear\", 0)";

	mysql_query('USE cmsfpix_u' , $connection);

	if(mysql_query($func,$connection)){
		echo("Wafer ".$id." has been added to the database.<br>");
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}


}

function sensorinfo($id, $notes, $wafer){
include('../connect.php');

	
	$date = date('Y-m-d H:i:s');

	if($notes != ""){
		$notes = $date."  ".$notes;
	}

	$func = "INSERT INTO sensor_p(notes, name, assoc_wafer, assembly) VALUES (\"$notes\", \"$id\", \"$wafer\", 0)";

	mysql_query('USE cmsfpix_u' , $connection);

	if(mysql_query($func,$connection)){
		echo("Sensor ".$id." has been added to the database.<br>");
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}

}

function measurement($id, $parttype, $scan, $notes, $file, $size, $name){
include('../connect.php');
include('../functions/curfunctions.php');

	$sensordata = dump("sensor", $id);
	$sensorname = $sensordata['name'];

	$date = date('Y-m-d H:i:s');

	if($notes != ""){
		$notes = $date."  ".$notes;
	}
	$func = "INSERT INTO measurement(part_ID, part_type, scan_type, notes, file, filesize, filename) VALUES (\"$id\", \"$parttype\", \"$scan\", \"$notes\", \"$file\",\"$size\",\"$name\")";
	
	mysql_query('USE cmsfpix_u', $connection);

	if(mysql_query($func,$connection)){
		echo "The $scan measurement on sensor $sensorname has been added to the database.<br>";
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}
	
}


function rocinfo($id, $manu, $arrival, $notes, $solder){
include('../connect.php');

	
	$date = date('Y-m-d H:i:s');

	if($notes != ""){
		$notes = $date."  ".$notes;
	}


	$func = "INSERT INTO ROC(notes, name, manufacturer, arrival, solder) VALUES (\"$notes\", \"$id\", \"$manu\", \"$arrival\", \"$solder\")";

	mysql_query('USE cmsfpix_u' , $connection);

	if(mysql_query($func,$connection)){
		echo("ROC ".$id." has been added to the database.<br>");
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}

}


function hdiinfo($id, $notes, $arrival){
include('../connect.php');

	$date = date('Y-m-d H:i:s');

	if($notes != ""){
		$notes = $date."  ".$notes;
	}

	$func = "INSERT INTO hdi(notes, name, arrival) VALUES (\"$notes\", \"$id\", \"$arrival\")";

	mysql_query('USE cmsfpix_u' , $connection);

	if(mysql_query($func,$connection)){
		echo("HDI ".$id." has been added to the database.<br>");
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}

}

function bare1x1info($sensor, $roc, $notes){
include('../connect.php');

	
	$date = date('Y-m-d H:i:s');
	
	if($notes != ""){
		$notes = $date."  ".$notes;
	}


	$sensornamefunc = "SELECT name FROM sensor WHERE id=\"$sensor\"";
	$sensornameout = mysql_query($sensornamefunc, $connection);
	$sensorrow = mysql_fetch_assoc($sensornameout);
	$sensorname = $sensorrow['name'];

	$rocnamefunc = "SELECT name FROM ROC WHERE id=\"$roc\"";
	$rocnameout = mysql_query($rocnamefunc, $connection);
	$rocrow = mysql_fetch_assoc($rocnameout);
	$rocname = $rocrow['name'];

	$name = $sensorname."_".$rocname;


	$func = "INSERT INTO BBM_bare_1x1(name, notes, assoc_sens, assoc_ROC, assembly) VALUES (\"$name\",\"$notes\", \"$sensor\", \"$roc\",0)";

	mysql_query('USE cmsfpix_u' , $connection);

	if(mysql_query($func,$connection)){
	
		$func2 = "UPDATE sensor SET module=\"$name\" WHERE id=\"$sensor\"";
		mysql_query($func2, $connection);
		echo("BBM ".$name." has been added to the database.<br>");
	}
	else{
		echo("An error has occurred and the data has not been added.<br>");
	}

}

function DAQinfo($module, $C0file, $C0size, $aPfile, $dPfile, $phfile, $sumfile, $SCDfile, $tPfile, $tP60file, $notes, $noise, $gain){

	include('../connect.php');

	$date = date('Y-m-d H:i:s');
	
	if($notes != ""){
		$notes = $date."  ".$notes;
	}

	$fnoise = floatval($noise);
	$fgain = floatval($gain);

	$C0 = fopen($C0file, 'r');
	$C0content = fread($C0, filesize($C0file));
	$C0content = addslashes($C0content);

	$aP = fopen($aPfile, 'r');
	$apcontent = fread($aP, filesize($aPfile));
	$apcontent = addslashes($apcontent);
	
	$dP = fopen($dPfile, 'r');
	$dpcontent = fread($dP, filesize($dPfile));
	$dpcontent = addslashes($dpcontent);

	$ph = fopen($phfile, 'r');
	$phcontent = fread($ph, filesize($phfile));
	$phcontent = addslashes($phcontent);

	$sum = fopen($sumfile, 'r');
	$sumcontent = fread($sum, filesize($sumfile));
	$sumcontent = addslashes($sumcontent);

	$SCD = fopen($SCDfile, 'r');
	$SCDcontent = fread($SCD, filesize($SCDfile));
	$SCDcontent = addslashes($SCDcontent);

	$tP = fopen($tPfile, 'r');
	$tpcontent = fread($tP, filesize($tPfile));
	$tpcontent = addslashes($tpcontent);
	
	$tP60 = fopen($tP60file, 'r');
	$tp60content = fread($tP60, filesize($tP60file));
	$tp60content = addslashes($tp60content);

	$func = "INSERT INTO DAQparameters(assoc_module, C0, C0size, addressParameters, dacParameters, phCalibrationFitTan, summary, SCurveData, testParameters, trimParameters, notes, Noise, Gain) VALUES (\"$module\",\"$C0content\", \"$C0size\",\"$apcontent\", \"$dpcontent\", \"$phcontent\", \"$sumcontent\", \"$SCDcontent\", \"$tpcontent\", \"$tp60content\", \"$notes\", \"$fnoise\", \"$fgain\")";

	mysql_query('USE cmsfpix_u', $connection);

	if(mysql_query($func, $connection)){
		echo "Parameters have been added to the database.<br>";
	}
	else{
		echo "An error has occurred and data has not been added.<br>";
	} 

	fclose($C0);
	fclose($aP);
	fclose($dP);
	fclose($sum);
	fclose($ph);
	fclose($SCD);
	fclose($tP);
	fclose($tP60);
}
?>
